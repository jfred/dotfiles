#!/bin/bash

# .wspace file should name and define the editors
# SESSIONNAME - the tmux session name
# WS_EDITORS - the editor windows
#   {WINNAME1}:{DIRECTORY1},{WINNAME2}:{DIRECTORY2}
CONF=`pwd`/.wspace
if [ ! -f $CONF ]
then
    echo "./.wspace file not found" >&2
    exit 1
fi
source `pwd`/.wspace

function project_editor {
    NAME=$1
    WINDOW=$2
    DIRECTORY=$3
    EDITOR=$4
    tmux new-window -t $SESSIONNAME:$WINDOW -n $NAME
    tmux send-keys "cd ${DIRECTORY}" "C-m"
    if [ "$EDITOR" = "vim" ]
    then
        tmux send-keys "vim" "C-m"
        tmux split-window -t $SESSIONNAME:$WINDOW -v
        tmux resize-pane -D 20
    fi
}

tmux has-session -t $SESSIONNAME > /dev/null 2>&1

if [ $? != 0 ]
then
    tmux new-session -s $SESSIONNAME -n bench -d

    # project_editor 'api' 2 '~/Code/some-directory' 'vim'
    i=2
    echo $WS_EDITORS | sed -n 1'p' | tr ',' '\n' | while read space; do
        parts=(`echo $space | tr ':' '\n'`)
        project_editor ${parts[0]} $i ${parts[1]} ${parts[2]}
        let i++
    done
    
fi
# switch to base window
tmux select-window -t $SESSIONAME:1
tmux attach -t $SESSIONNAME
